<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.CommodityTabDao">
	<!-- 添加商品信息 -->
	<insert id="addCommodityTab" parameterType="com.entity.CommodityTab" useGeneratedKeys="true" keyProperty="comm_id">
		INSERT INTO commodity_tab(comm_type,
		comm_cate_id,comm_supp_id,comm_brand_id,comm_name,comm_model,comm_unit,comm_main_img,comm_else_img,comm_details,comm_weight
		<if test="comm_price!=null">
			,comm_price
		</if>
		<if test="comm_id!=null">
			,comm_id
		</if>
		<if test="comm_current_price!=null">
			,comm_current_price
		</if>
		<if test="comm_status!=null">
			,comm_status
		</if>
		<if test="lock_status!=null">
			,lock_status
		</if>
		<if test="offline_price!=null">
			,offline_price
		</if>
		<if test="comm_specification!=null">
			,comm_specification
		</if>
		<if test="comm_putaway_id!=null and comm_putaway_id!=0">
			,comm_putaway_id
		</if>
		)
		VALUES
		(#{comm_type},#{comm_cate_id},#{comm_supp_id},#{comm_brand_id},#{comm_name},#{comm_model},#{comm_unit},#{comm_main_img},'${comm_else_img}',#{comm_details},#{comm_weight}
		<if test="comm_price!=null">
			,#{comm_price}
		</if>
		<if test="comm_id!=null">
			,#{comm_id}
		</if>
		<if test="comm_current_price!=null">
			,#{comm_current_price}
		</if>
		<if test="comm_status!=null">
			,#{comm_status}
		</if>
		<if test="lock_status!=null">
			,#{lock_status}
		</if>
		<if test="offline_price!=null">
			,#{offline_price}
		</if>
		<if test="comm_specification!=null">
			,'${comm_specification}'
		</if>
		<if test="comm_putaway_id!=null and comm_putaway_id!=0">
			,#{comm_putaway_id}
		</if>
		)
	</insert>
	<!-- 查询商品信息 -->
	<select id="queryCommodityTab" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT
		(select sum(stoc_count) from stock_tab st where st.comm_id=com.comm_putaway_id)stoc_count,com.comm_id,comm_specification,comm_supp_id,comm_type,comm_cate_id,comm_brand_id,comm_name,comm_model,comm_unit,comm_price,comm_current_price,comm_main_img,comm_else_img,comm_details,comm_putaway_id,comm_status,comm_weight,lock_status,offline_price
		FROM commodity_tab com
		WHERE 1=1
		<if test="comm_id!=null">
			and com.comm_id = #{comm_id}
		</if>
		<if test="comm_cate_id!=null">
			and comm_cate_id = #{comm_cate_id}
		</if>
		<if test="comm_supp_id!=null">
			and comm_supp_id = #{comm_supp_id}
		</if>
		<if test="comm_brand_id!=null">
			and comm_brand_id = #{comm_brand_id}
		</if>
		<if test="comm_name!=null">
			and comm_name = #{comm_name}
		</if>
		<if test="comm_model!=null">
			and comm_model = #{comm_model}
		</if>
		<if test="comm_unit!=null">
			and comm_unit = #{comm_unit}
		</if>
		<if test="comm_putaway_id!=null">
			and comm_putaway_id = #{comm_putaway_id}
		</if>
		<if test="disc_comm_putaway_id!=null">
			and comm_putaway_id = #{disc_comm_putaway_id}
		</if>
		<if test="comm_status!=null">
			and comm_status = #{comm_status}
		</if>
		<if test="offline_price!=null">
			and offline_price = #{offline_price}
		</if>
		<if test="lock_status!=null">
			and lock_status = #{lock_status}
		</if>
		<if test="comm_type!=null">
			and comm_type = #{comm_type}
		</if>
		<if test="offline!=null">
			and comm_type != #{offline}
		</if>
		ORDER BY comm_weight DESC,comm_putaway_id DESC
		LIMIT #{page} OFFSET #{nums}
	</select>
	<!-- 查询商品总数信息 -->
	<select id="queryCommodityTabCount" resultType="int"
		parameterType="java.util.HashMap">
		SELECT COUNT(comm_id) FROM commodity_tab WHERE 1=1
		<if test="comm_id!=null">
			and comm_id = #{comm_id}
		</if>
		<if test="comm_cate_id!=null">
			and comm_cate_id = #{comm_cate_id}
		</if>
		<if test="comm_supp_id!=null">
			and comm_supp_id = #{comm_supp_id}
		</if>
		<if test="comm_brand_id!=null">
			and comm_brand_id = #{comm_brand_id}
		</if>
		<if test="comm_name!=null">
			and comm_name = #{comm_name}
		</if>
		<if test="comm_model!=null">
			and comm_model = #{comm_model}
		</if>
		<if test="comm_unit!=null">
			and comm_unit = #{comm_unit}
		</if>
		<if test="comm_putaway_id!=null">
			and comm_putaway_id = #{comm_putaway_id}
		</if>
		<if test="comm_status!=null">
			and comm_status = #{comm_status}
		</if>
		<if test="offline_price!=null">
			and offline_price = #{offline_price}
		</if>
		<if test="lock_status!=null">
			and lock_status = #{lock_status}
		</if>
		<if test="comm_type!=null">
			and comm_type = #{comm_type}
		</if>
		<if test="offline!=null">
			and comm_type != #{offline}
		</if>
	</select>
	<!-- 更新商品信息 -->
	<update id="updateCommodityTab" parameterType="com.entity.CommodityTab">
		UPDATE commodity_tab
		<trim prefix="set" suffixOverrides=",">
			<if test="comm_type!=null">
				comm_type=#{comm_type},
			</if>
			<if test="comm_specification!=null">
				comm_specification='${comm_specification}',
			</if>
			<if test="comm_cate_id!=0">
				comm_cate_id=#{comm_cate_id},
			</if>
			<if test="comm_supp_id!=0">
				comm_supp_id=#{comm_supp_id},
			</if>
			<if test="comm_brand_id!=0">
				comm_brand_id=#{comm_brand_id},
			</if>
			<if test="comm_name!=null">
				comm_name=#{comm_name},
			</if>
			<if test="comm_model!=null">
				comm_model=#{comm_model},
			</if>
			<if test="comm_unit!=null">
				comm_unit=#{comm_unit},
			</if>
			<if test="comm_price!=null">
				comm_price=${comm_price},
			</if>
			<if test="comm_current_price!=null">
				comm_current_price=${comm_current_price},
			</if>
			<if test="comm_main_img!=null">
				comm_main_img=#{comm_main_img},
			</if>
			<if test="comm_else_img!=null">
				comm_else_img='${comm_else_img}',
			</if>
			<if test="comm_details!=null">
				comm_details=#{comm_details},
			</if>
			<if test="comm_putaway_id!=null">
				comm_putaway_id=#{comm_putaway_id},
			</if>
			<if test="comm_status!=null">
				comm_status=#{comm_status},
			</if>
			<if test="comm_weight!=null">
				comm_weight=#{comm_weight},
			</if>
			<if test="offline_price!=null">
				offline_price=#{offline_price},
			</if>
			<if test="lock_status!=null">
				lock_status=#{lock_status},
			</if>
		</trim>
		WHERE comm_putaway_id =#{comm_putaway_id}
	</update>
	<!-- 删除商品信息 -->
	<delete id="deleteCommodityTab" parameterType="int">
		DELETE FROM
		commodity_tab WHERE comm_putaway_id =#{comm_putaway_id}
	</delete>
	<!-- 根据商品名称和ID模糊搜索名称或ID -->
	<select id="queryCommName" parameterType="java.util.HashMap"
		resultType="java.util.HashMap">
		SELECT comm_name,comm_putaway_id comm_id FROM commodity_tab WHERE comm_name
		LIKE CONCAT('%',#{comm_name},'%' ) OR to_char(comm_id,'999999999')
		LIKE CONCAT('%',#{comm_name},'%' ) and comm_status != '停售'
	</select>

	<resultMap type="java.util.HashMap" id="category_tab">
		<id property="cate_id" column="cate_id" />
		<result property="cate_name" column="cate_name" />
		<result property="cate_superior" column="cate_superior" />
		<result property="cate_weight" column="cate_weight" />
	</resultMap>
	<resultMap type="java.util.HashMap" id="supplier_tab">
		<id property="supp_id" column="supp_id" />
		<result property="supp_name" column="supp_name" />
		<result property="supp_logo" column="supp_logo" />
		<result property="supp_weight" column="supp_weight" />
	</resultMap>
	<resultMap type="java.util.HashMap" id="brand_tab">
		<id property="brand_id" column="brand_id" />
		<result property="brand_supp_id" column="brand_supp_id" />
		<result property="brand_cate_id" column="brand_cate_id" />
		<result property="brand_name" column="brand_name" />
		<result property="brand_logo" column="brand_logo" />
		<result property="brand_weight" column="brand_weight" />
	</resultMap>
	<resultMap type="java.util.HashMap" id="FrontCommodityTab">
		<id property="comm_id" column="comm_id" />
		<result property="comm_type" column="comm_type" />
		<result property="comm_cate_id" column="comm_cate_id" />
		<result property="comm_supp_id" column="comm_supp_id" />
		<result property="comm_specification" column="comm_specification" />
		<result property="comm_brand_id" column="comm_brand_id" />
		<result property="comm_name" column="comm_name" />
		<result property="comm_model" column="comm_model" />
		<result property="comm_unit" column="comm_unit" />
		<result property="lock_status" column="lock_status" />
		<result property="offline_price" column="offline_price" />
		<result property="comm_price" column="comm_price" />
		<result property="comm_current_price" column="comm_current_price" />
		<result property="comm_main_img" column="comm_main_img" />
		<result property="comm_else_img" column="comm_else_img" />
		<result property="comm_details" column="comm_details" />
		<result property="comm_putaway_id" column="comm_putaway_id" />
		<result property="comm_status" column="comm_status" />
		<result property="comm_weight" column="comm_weight" />
		<collection property="category_tab" resultMap="category_tab"></collection>
		<collection property="supplier_tab" resultMap="supplier_tab"></collection>
		<collection property="brand_tab" resultMap="brand_tab"></collection>
	</resultMap>
	<!-- 前端查询商品信息 -->
	<select id="quertFrontCommodityTab" parameterType="java.util.HashMap"
		resultMap="FrontCommodityTab">
		SELECT 
		comm_id,comm_specification,comm.lock_status,offline_price,comm_type,comm_cate_id,comm_brand_id,comm_name,comm_model,comm_unit,comm_price,comm_current_price,comm_main_img,comm_else_img,comm_details,comm_putaway_id,comm_status,comm_weight,
		cate_id,cate_name,cate_superior,cate_weight,
		supp_id,supp_name,supp_logo,supp_weight,
		brand_id,brand_supp_id,brand_cate_id,brand_name,brand_logo,brand_weight
		FROM commodity_tab comm
		LEFT JOIN category_tab cate ON
		comm.comm_cate_id = cate.cate_id
		LEFT JOIN supplier_tab supp ON
		comm.comm_supp_id = supp.supp_id
		LEFT JOIN brand_tab ON
		comm.comm_brand_id = brand_tab.brand_id
		WHERE 1=1 AND comm_status='在售'
		AND comm_type != #{comm_type}
		<if test="cate_name!=null">
			and (cate_name LIKE CONCAT('%',#{cate_name},'%' ) OR
			comm_name LIKE CONCAT('%',#{cate_name},'%' ))
		</if>
		<if test="comm_id!=null">
			and comm_putaway_id=#{comm_id}
		</if>
		<if test="brand_list!=null">
			<if test="brand_list.size()>0">
				and comm_brand_id in
				<foreach collection="brand_list" item="employeeId" index="index"
					open="(" close=")" separator=",">
					#{employeeId}
				</foreach>
			</if>
		</if>
		<if test="brand_cate_id!=null">
			<if test="brand_cate_id.size()>0">
				and comm_cate_id in 
				<foreach collection="brand_cate_id" item="employeeId" index="index"
					open="(" close=")" separator=",">
					#{employeeId}
				</foreach>
			</if>
		</if>


		<if test="sort==0">
			ORDER BY comm_weight DESC,comm_putaway_id DESC
		</if>
		<if test="sort==1">
			ORDER BY cast(comm_price as FLOAT ) ASC,comm_putaway_id DESC
		</if>
		<if test="sort==2">
			ORDER BY cast(comm_price as FLOAT ) DESC,comm_putaway_id DESC 
		</if>
		LIMIT #{page} OFFSET #{nums}
	</select>
	<!-- 查询前端商品总条数 -->
	<select id="quertFrontCommodityTabCount" parameterType="java.util.HashMap"
		resultType="int">
		SELECT
		count(comm_id)
		FROM commodity_tab comm
		LEFT JOIN category_tab cate
		ON comm.comm_cate_id = cate.cate_id
		LEFT JOIN supplier_tab supp ON
		comm.comm_supp_id = supp.supp_id
		LEFT JOIN brand_tab ON
		comm.comm_brand_id = brand_tab.brand_id
		WHERE 1=1 AND comm_status='在售'
		AND comm_type != #{comm_type}
		<if test="cate_name!=null">
			and (cate_name LIKE CONCAT('%',#{cate_name},'%' ) OR
			comm_name LIKE CONCAT('%',#{cate_name},'%' ))
		</if>
		<if test="comm_id!=null">
			and comm_putaway_id=#{comm_id}
		</if>
		<if test="brand_list!=null">
			<if test="brand_list.size()>0">
				and comm_brand_id in
				<foreach collection="brand_list" item="employeeId" index="index"
					open="(" close=")" separator=",">
					#{employeeId}
				</foreach>
			</if>
		</if>
		<if test="brand_cate_id!=null">
			<if test="brand_cate_id.size()>0">
				and comm_cate_id in 
				<foreach collection="brand_cate_id" item="employeeId" index="index"
					open="(" close=")" separator=",">
					#{employeeId}
				</foreach>
			</if>
		</if>
	</select>
	<!-- 查询后端商城商品信息 -->
	<select id="queryCommodityTabBack" parameterType="java.util.HashMap"
		resultMap="FrontCommodityTab">
		SELECT
		comm_id,comm_specification,comm.lock_status,offline_price,comm_type,comm_cate_id,comm_brand_id,comm_name,comm_model,comm_unit,comm_price,comm_current_price,comm_main_img,comm_else_img,comm_details,comm_putaway_id,comm_status,comm_weight,
		cate_id,cate_name,cate_superior,cate_weight,
		supp_id,supp_name,supp_logo,supp_weight,
		brand_id,brand_supp_id,brand_cate_id,brand_name,brand_logo,brand_weight
		FROM commodity_tab comm
		LEFT JOIN category_tab cate ON
		comm.comm_cate_id = cate.cate_id
		LEFT JOIN supplier_tab supp ON
		comm.comm_supp_id = supp.supp_id
		LEFT JOIN brand_tab ON
		comm.comm_brand_id = brand_tab.brand_id
		WHERE 1=1 AND comm_status='在售'
		AND comm_type != '线上'
		<if test="cate_name!=null">
			and cate_name =#{cate_name}
		</if>
		<if test="cate_id!=null">
			and cate_id =#{cate_id}
		</if>
		<if test="comm_id!=null">
			and comm_putaway_id=#{comm_id}
		</if>
		<if test="comm_name!=null">
			and comm_name LIKE CONCAT('%',#{comm_name},'%' )
		</if>
		ORDER BY comm_weight DESC
		LIMIT #{page} OFFSET #{nums}
	</select>
	<!-- 查询后端商城商品信息总数 -->
	<select id="queryCommodityTabBackCount" parameterType="java.util.HashMap"
		resultType="int">
		SELECT
		count(comm_id)
		FROM commodity_tab comm
		LEFT JOIN category_tab cate
		ON comm.comm_cate_id = cate.cate_id
		LEFT JOIN supplier_tab supp ON
		comm.comm_supp_id = supp.supp_id
		LEFT JOIN brand_tab ON
		comm.comm_brand_id = brand_tab.brand_id
		WHERE 1=1 AND comm_status='在售'
		AND comm_type != '线上'
		<if test="cate_name!=null">
			and cate_name =#{cate_name}
		</if>
		<if test="cate_id!=null">
			and cate_id =#{cate_id}
		</if>
		<if test="comm_id!=null">
			and comm_putaway_id=#{comm_id}
		</if>
		<if test="comm_name!=null">
			and comm_name LIKE CONCAT('%',#{comm_name},'%' )
		</if>
	</select>
	<!-- 查询品类ID信息 -->
	<select id="queryCategoryID" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		SELECT cate_id FROM category_tab WHERE 1=1 
		<if test="brand_cate_id!=null">
			and cate_id=#{brand_cate_id}
		</if>
		<if test="cate_superior!=null">
			and cate_superior=#{cate_superior}
		</if>
	</select>
	<!-- 根据商品ID查询库存量信息 -->
	<select id="querystockTab" parameterType="java.util.HashMap" resultType="java.lang.Integer">
		SELECT sum(stoc_count) stock FROM stock_tab WHERE comm_id = #{comm_putaway_id}
	</select>
	<!-- 总实例添加商品时查询添加的商品ID -->
	<select id="queryPushCommodityID" parameterType="int" resultType="java.util.HashMap">
		SELECT comm_putaway_id FROM commodity_tab where comm_id = #{comm_id}
	</select>
</mapper>