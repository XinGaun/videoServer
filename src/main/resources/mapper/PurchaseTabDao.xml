<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.PurchaseTabDao">
	<!-- 添加采购单 -->
	<insert id="addPurchaseTab" parameterType="java.util.HashMap" useGeneratedKeys="true" keyProperty="purc_id">
		INSERT INTO
		purchase_tab(purc_date, purc_status,staff_id,purc_need_id) VALUES
		(to_timestamp(#{purc_date},'yyyy-mm-dd hh24:mi:ss'),#{purc_status},#{staff_id},#{purc_need_id})
	</insert>
	<!-- 查询采购单 -->
	<select id="queryPurchaseTab" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT purc_id,to_char(purc_date,'yyyy-mm-dd hh24:mi:ss')purc_date,purc_status,staff_id,purc_need_id FROM purchase_tab WHERE
		1=1
		<if test="purc_id!=null">
			and purc_id = #{purc_id}
		</if>
		<if test="purc_date!=null">
			and purc_date = to_timestamp(#{purc_date},'yyyy-mm-dd hh24:mi:ss')
		</if>
		<if test="purc_status!=null">
			and purc_status = #{purc_status}
		</if>
		<if test="staff_id!=null">
			and staff_id = #{staff_id}
		</if> 
		<if test="purc_need_id!=null">
			and purc_need_id = #{purc_need_id}
		</if> 
		ORDER BY purc_id DESC 
		LIMIT #{page} OFFSET #{nums}
	</select>
	<!-- 查询采购单总数信息 -->
	<select id="queryPurchaseTabCount" resultType="int"
		parameterType="java.util.HashMap">
		SELECT COUNT(purc_id) FROM purchase_tab WHERE 1=1
		<if test="purc_id!=null">
			and purc_id = #{purc_id}
		</if>
		<if test="purc_date!=null">
			and purc_date = to_timestamp(#{purc_date},'yyyy-mm-dd hh24:mi:ss')
		</if>
		<if test="purc_status!=null">
			and purc_status = #{purc_status}
		</if>
		<if test="staff_id!=null">
			and staff_id = #{staff_id}
		</if>
	</select>
	<!-- 更新采购单信息 -->
	<update id="updatePurchaseTab" parameterType="com.entity.PurchaseTab">
		UPDATE purchase_tab
		<trim prefix="set" suffixOverrides=",">
			<if test="purc_date!=null">
				purc_date=to_timestamp(#{purc_date},'yyyy-mm-dd hh24:mi:ss'),
			</if>
			<if test="purc_status!=null">
				purc_status=#{purc_status},
			</if>
			<if test="staff_id!=null">
				staff_id = #{staff_id},
			</if>
		</trim>
		WHERE purc_id =#{purc_id}
	</update>
	<!-- 删除采购单信息 -->
	<delete id="deletePurchaseTab" parameterType="int">
		DELETE FROM
		purchase_tab WHERE purc_id =#{purc_id}
	</delete>
	<!-- 查询商品信息 -->
	<select id="queryCommodity" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT comm_id,comm_supp_id,comm_specification,comm_cate_id,comm_brand_id,comm_name,comm_model,comm_unit,comm_price,comm_current_price,comm_main_img,comm_else_img,comm_details,comm_putaway_id,comm_status,comm_weight FROM commodity_tab WHERE 1=1 
		<if test="comm_id!=null">
			and comm_putaway_id = #{comm_id}
		</if>
	</select>
	<!-- 查询门店s信息 -->
	<select id="queryShop" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT shop_id,shop_name,shop_addr,shop_date FROM
		shop_tab WHERE 1=1 
		<if test="shop_id!=null">
			and shop_id = #{shop_id}
		</if>
		<if test="shop_id==null">
			and shop_id = -1
		</if>
	</select>
</mapper>