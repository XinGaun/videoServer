<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.PersonalCenterDao">
	<!-- 查询收藏课程详情 -->
	<select id="queryPersonalCenter" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select c.courses_name,c.courses_img_url,date_format(c.courses_date,'%Y-%m-%d')courses_date,c.courses_pricemoney,c.courses_grade,c.courses_click,c.courses_id 
		from user_tab u 
		LEFT JOIN subscription_tab s ON s.user_id = u.user_id 
		LEFT JOIN courses_tab c ON c.courses_id = s.video_id 
		WHERE 1=1 AND u.user_status=5  
		<if test="userphone!=''">
 			AND u.user_phone = #{userphone} 
 		</if>
 		<if test="searchSubmit!=''">
 			AND c.courses_name like '%${searchSubmit}%'  
 		</if>
 		<if test="number!=''">
			DELETE FROM subscription_tab WHERE video_id = #{number}
		</if>
		 ORDER BY c.courses_date DESC LIMIT #{nums},#{page}
	</select>
	<!-- 删除收藏课程-->
	<delete id="deleteSubscription" parameterType="java.util.HashMap">
		<if test="number!=''">
			DELETE FROM subscription_tab WHERE video_id = #{number}
		</if>
	</delete>
	<!-- 查询收藏课程总数 -->
	<select id="queryPersonalCenterAllCount" parameterType="java.util.HashMap" resultType="int">
		select count(c.courses_id) 
		from user_tab u 
		LEFT JOIN subscription_tab s ON s.user_id = u.user_id 
		LEFT JOIN courses_tab c ON c.courses_id = s.video_id 
		WHERE 1=1 AND u.user_status=5  
		<if test="userphone!=''">
 			AND u.user_phone = #{userphone} 
 		</if>
	</select>
	<!-- 查询所有推荐课程 -->
	<select id="queryRecommend" resultType="java.util.HashMap">
		SELECT
		teacher_name,courses_id,teacher_tab.teacher_id,courses_name,courses_introduce,courses_pricemoney,courses_click,courses_img_url,courses_grade,date_format(courses_date,'%Y-%m-%d')courses_date
		FROM courses_tab
		LEFT JOIN teacher_tab ON
		teacher_tab.teacher_id=courses_tab.teacher_id
		WHERE 1=1 AND
		courses_status = 5 order by courses_date DESC LIMIT 0,3
	</select>
	<!-- 查询订单详情 -->
	<select id="queryOrderInformation" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select o.order_id,o.video_id,c.courses_name,date_format(order_date,'%Y-%m-%d')order_date,o.order_status,o.order_pricemoney,o.user_id 
		from order_tab o 
		LEFT JOIN courses_tab c ON c.courses_id= o.video_id 
		LEFT JOIN user_tab u ON u.user_id = o.user_id where o.order_status='已付款'   
		<if test="userphone!=''">
 			AND u.user_phone = #{userphone} 
 		</if>
		 ORDER BY c.courses_date DESC LIMIT #{nums},#{page}
	</select>
	<!-- 查询收藏课程总数 -->
	<select id="queryOrderInformationAllCount" parameterType="java.util.HashMap" resultType="int">
		select count(o.order_id) 
		from test.order_tab o 
		LEFT JOIN test.courses_tab c ON c.courses_id= o.video_id 
		LEFT JOIN test.user_tab u ON u.user_id = o.user_id where o.order_status='已付款' 
		<if test="userphone!=''">
 			AND u.user_phone = #{userphone} 
 		</if>
	</select>
</mapper>