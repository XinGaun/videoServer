<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.CommentTabDao">
	<!-- 添加 -->
	<insert id="addCommentTabMap" parameterType="java.util.HashMap"
		keyProperty="comment_id">
		INSERT INTO
		comment_tab(video_id,user_id,comment_text,comment_date
		<if test="reply_text != null">
			,reply_text
		</if>
		<if test="reply_teacher!=null">
			,reply_teacher
		</if>
		<if test="reply_date!=null">
			,reply_date
		</if>
		)
		VALUES (#{video_id},#{user_id},#{comment_text},#{comment_date}
		<if test="reply_text != null">
			,#{reply_text}
		</if>
		<if test="reply_teacher!=null">
			,#{reply_teacher}
		</if>
		<if test="reply_date!=null">
			,#{reply_date}
		</if>
		)
	</insert>

	<insert id="addCommentTabEntity" parameterType="com.entity.CommentTab"
		keyProperty="comment_id">
		INSERT INTO
		comment_tab(video_id,user_id,comment_text,comment_date,reply_text,reply_teacher,reply_date)
		values(#{videoId},#{userId},#{commentText},#{commentDate},#{replyText},#{replyTeacher},#{replyDate})
	</insert>

	<!-- 查询 -->
	<select id="queryCommentTab" parameterType="java.util.HashMap"
		resultType="java.util.HashMap">
		SELECT c.comment_id, v.video_name ,u.user_name ,c.comment_text,
		c.comment_date,c.reply_text,t.teacher_name,c.reply_date,c.comment_status FROM
		comment_tab c LEFT JOIN video_tab v ON c.video_id = v.video_id
		LEFT
		JOIN user_tab u ON c.user_id = u.user_id LEFT JOIN teacher_tab t ON
		c.reply_teacher = t.teacher_id
		<where>
			<if test="comment_id != null and comment_id !='' ">
				and c.comment_id = #{comment_id}
			</if>
			<if test="video_name != null and video_name !='' ">
				and v.video_name = #{video_name}
			</if>
			<if test="user_name != null and user_name !='' ">
				and u.user_name = #{user_name}
			</if>
			<if test="teacher_name != null and teacher_name !='' ">
				and t.teacher_name = #{teacher_name}
			</if>
			<if test="comment_start!='' and comment_start!=null">
				and c.comment_date >= str_to_date(#{comment_start},
				'%Y-%m-%d')
			</if>
			<if test="comment_start!=comment_end">
				<if test="comment_end!='' and comment_end!=null">
					and c.comment_date &lt;= str_to_date(#{comment_end},
					'%Y-%m-%d')
				</if>
			</if>
			<if test="teacher_id != null and teacher_id !='' ">
				and t.teacher_id = #{teacher_id}
			</if>
		</where>
		limit #{start},#{limit}
	</select>
	<!-- 查询总数 -->
	<select id="queryCount" parameterType="java.util.HashMap"
		resultType="int">
		SELECT count(c.comment_id) FROM
		comment_tab c LEFT JOIN video_tab v ON
		c.video_id = v.video_id
		LEFT JOIN user_tab u ON c.user_id = u.user_id
		LEFT JOIN teacher_tab t ON
		c.reply_teacher = t.teacher_id
		<where>
			<if test="comment_id != null and comment_id !='' ">
				and c.comment_id = #{comment_id}
			</if>
			<if test="video_name != null and video_name !='' ">
				and v.video_name = #{video_name}
			</if>
			<if test="user_name != null and user_name !='' ">
				and u.user_name = #{user_name}
			</if>
			<if test="teacher_name != null and teacher_name !='' ">
				and t.teacher_name = #{teacher_name}
			</if>
			<if test="comment_start!='' and comment_start!=null">
				and c.comment_date >= str_to_date(#{comment_start},
				'%Y-%m-%d')
			</if>
			<if test="comment_start!=comment_end">
				<if test="comment_end!='' and comment_end!=null">
					and c.comment_date &lt;= str_to_date(#{comment_end},
					'%Y-%m-%d')
				</if>
			</if>
		</where>
		limit #{start},#{limit}
	</select>
	<!-- 更新 -->
	<update id="updateCommentTab" parameterType="java.util.HashMap">
		UPDATE comment_tab
		<set>
			<if test="video_id != null">
				video_id = #{video_id} ,
			</if>
			<if test="user_id != null">
				user_id = #{user_id} ,
			</if>
			<if test="comment_text != null">
				comment_text = #{comment_text} ,
			</if>
			<if test="comment_date != null">
				comment_date = #{comment_date} ,
			</if>
			<if test="reply_text != null">
				reply_text = #{reply_text} ,
			</if>
			<if test="reply_teacher != null">
				reply_teacher = #{reply_teacher} ,
			</if>
			<if test="comment_status != null">
				comment_status = #{comment_status} ,
			</if>
			<if test="reply_date != null">
				reply_date = now(),
			</if>
		</set>
		<where>
			comment_id = #{comment_id}
		</where>
	</update>
	<delete id="deleteCommentTab" parameterType="int">
		DELETE FROM comment_tab
		<where>
			comment_id = #{comment_id}
		</where>
	</delete>
</mapper>