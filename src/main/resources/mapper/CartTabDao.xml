<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.CartTabDao">
	<!-- 添加购物车信息 -->
	<insert id="addCartTab" parameterType="com.entity.CartTab">
		INSERT INTO
		cart_tab(buye_id, comm_putaway_id,cart_num,cart_date) VALUES
		(#{buye_id},#{comm_putaway_id},#{cart_num},now())
	</insert>
	<!-- 查询购物车信息 -->
	<select id="queryCartTab" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT ca.cart_id,ca.buye_id,ca.cart_num,to_char(cart_date,'yyyy-mm-dd hh24:mi:ss')cart_date,
		bu.buye_phone,bu.nineteen_id,
		co.comm_brand_id,co.comm_cate_id,co.comm_id,co.comm_current_price,co.comm_details,co.comm_else_img,co.comm_main_img,
		co.comm_model,co.comm_name,co.comm_price,co.comm_specification,co.comm_status,co.comm_supp_id,co.comm_unit,co.comm_weight
		FROM cart_tab ca
		LEFT JOIN buyer_tab bu ON ca.buye_id = bu.buye_id
		LEFT JOIN commodity_tab co on ca.comm_putaway_id = co.comm_putaway_id
		WHERE 1=1 
		<if test="cart_id!=null">
			and ca.cart_id = #{cart_id}
		</if>
		<if test="buye_id!=null">
			and ca.buye_id = #{buye_id}
		</if>
		<if test="comm_putaway_id!=null">
			and ca.comm_putaway_id = #{comm_putaway_id}
		</if>
		<if test="cart_date!=null">
			and ca.cart_date = #{cart_date}
		</if>
		LIMIT #{page} OFFSET #{nums}
	</select>
	<!-- 查询购物车总数信息 -->
	<select id="queryCartTabCount" resultType="int" parameterType="java.util.HashMap">
		SELECT COUNT(ca.cart_id) FROM cart_tab ca
		LEFT JOIN buyer_tab bu ON ca.buye_id = bu.buye_id
		LEFT JOIN commodity_tab co on ca.comm_putaway_id = co.comm_putaway_id
		WHERE 1=1 
		<if test="cart_id!=null">
			and ca.cart_id = #{cart_id}
		</if>
		<if test="buye_id!=null">
			and ca.buye_id = #{buye_id}
		</if>
		<if test="comm_putaway_id!=null">
			and ca.comm_putaway_id = #{comm_putaway_id}
		</if>
		<if test="cart_date!=null">
			and ca.cart_date = #{cart_date}
		</if>
	</select>
	<!-- 更新购物车信息 -->
	<update id="updateCartTab" parameterType="com.entity.CartTab">
		UPDATE cart_tab
		<trim prefix="set" suffixOverrides=",">
			<if test="comm_putaway_id!=0">
				comm_putaway_id=#{comm_putaway_id},
			</if>
			<if test="cart_num!=0">
				cart_num=#{cart_num},
			</if>
		</trim>
		WHERE cart_id =#{cart_id}
	</update>
	<!-- 删除购物车信息 -->
	<delete id="deleteCartTab" parameterType="int">
		DELETE FROM cart_tab
		WHERE cart_id =#{cart_id}
	</delete>
</mapper>