<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.WantTabDao">
	<!-- 添加缺货登记信息 -->
	<insert id="addWantTab" parameterType="com.entity.WantTab">
		INSERT INTO
		want_tab(orde_id,comm_id,want_num,want_date,buye_id,want_phone
		<if test="purc_need_id!=null">
			,purc_need_id
		</if>
		) VALUES
		(#{orde_id},#{comm_id},#{want_num},to_timestamp(#{want_date},'yyyy-mm-dd hh24:mi:ss'),#{buye_id},#{want_phone}
		<if test="purc_need_id!=null">
			,#{purc_need_id}
		</if>
		)
	</insert>
	<!-- 查询缺货登记信息 -->
	<select id="queryWantTab" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		SELECT want_id,orde_id,comm_id,want_num,to_char(want_date,'yyyy-mm-dd hh24:mi:ss')want_date,buye_id,want_phone,purc_need_id,want_status FROM want_tab WHERE 1=1 
		<if test="want_id!=null">
			and want_id = #{want_id}
		</if> 
		<if test="orde_id!=null">
			and orde_id = #{orde_id}
		</if>  
		<if test="comm_id!=null">
			and comm_id = #{comm_id}
		</if> 
		<if test="buye_id!=null">
			and buye_id = #{buye_id}
		</if> 
		<if test="want_phone!=null">
			and want_phone = #{want_phone}
		</if> 
		<if test="want_status!=null">
			and want_status = #{want_status}
		</if> 
		<if test="purc_need_id!=null">
			and purc_need_id = #{purc_need_id}
		</if> 
		LIMIT #{page} OFFSET #{nums}
	</select>
	<!-- 查询缺货登记信息总条数 -->
	<select id="queryWantTabCount" resultType="int" parameterType="java.util.HashMap">
		SELECT COUNT(want_id) FROM
		want_tab WHERE 1=1 
		<if test="want_id!=null">
			and want_id = #{want_id}
		</if> 
		<if test="orde_id!=null">
			and orde_id = #{orde_id}
		</if>  
		<if test="comm_id!=null">
			and comm_id = #{comm_id}
		</if> 
		<if test="buye_id!=null">
			and buye_id = #{buye_id}
		</if> 
		<if test="want_phone!=null">
			and want_phone = #{want_phone}
		</if> 
		<if test="purc_need_id!=null">
			and purc_need_id = #{purc_need_id}
		</if> 
		<if test="want_status!=null">
			and want_status = #{want_status}
		</if> 
	</select>
	<!-- 更新缺货登记名称信息 -->
	<update id="updateWantTab" parameterType="com.entity.WantTab">
		UPDATE want_tab 
		<trim prefix="set" suffixOverrides=",">
			<if test="orde_id!=null">
				orde_id=#{orde_id},
			</if>
			<if test="comm_id!=null">
				comm_id=#{comm_id},
			</if>
			<if test="want_num!=null">
				want_num=#{want_num},
			</if>
			<if test="want_date!=null">
				want_date=to_timestamp(#{want_date},'yyyy-mm-dd hh24:mi:ss'),
			</if>
			<if test="buye_id!=null">
				buye_id=#{buye_id},
			</if>
			<if test="want_phone!=null">
				want_phone=#{want_phone},
			</if>
			<if test="purc_need_id!=null">
				purc_need_id=#{purc_need_id},
			</if>
			<if test="want_status!=null">
				want_status = #{want_status},
			</if> 
		</trim>
		WHERE want_id =#{want_id}
	</update>
	<!-- 删除缺货登记信息 -->
	<delete id="deleteWantTab" parameterType="int">
		DELETE from want_tab WHERE want_id=#{want_id}
	</delete>
	<!-- 添加采购需求信息 -->
	<insert id="addprocurement" parameterType="java.util.HashMap" useGeneratedKeys="true" keyProperty="purc_need_id">
		INSERT INTO purchase_need_tab(comm_id, shop_id, purc_need_num, apply_date, staff_id, purc_need_status, acc_num) VALUES
  		(#{comm_id},#{shop_id},#{want_num},now(),#{staf_id},'创建',0)
	</insert>
	<!-- 更新缺货登记信息 -->
	<update id="updatescWantTab" parameterType="java.util.HashMap">
		UPDATE want_tab set want_status = #{want_status},purc_need_id=#{purc_need_id} where want_id =#{want_id}
	</update>
</mapper>