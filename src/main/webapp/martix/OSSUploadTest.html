<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
#jd:after {
	content: '%';
}
</style>
<link rel="stylesheet"
	href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
<script
	src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>
	<h3>File upload demo</h3>
	<form action="/videoServer/UploadServlet/upload" method="post"
		enctype="multipart/form-data" id="dataForm">
		<input type="text" name="videoName" id="videoName" > <br>
		<input type="file" name="video" id="video" accept="video/*"><br> <input
			type="file" name="image" id="image" accept="image/*"> <br> <input
			type="submit" value="submit" id="submit">
	</form>


	<div id="jd"></div>
</body>
<script src="assets/js/jquery-1.10.2.js"></script>
<script type="text/javascript">
(function() {			
	 var progress = document.getElementById("jd");

	$("#submit").click(function(){
		//表单参数
		 var formData = new FormData();  //重点：要用这种方法接收表单的参数  
		 var video = $('#video').prop("files")[0];
		 var image = $('#image').prop("files")[0];
		 var videoName = $('#videoName').val();  
		 formData.append("videoName",videoName);  
		 formData.append("video", video);  
		 formData.append("image", image);  
		//阻止默认事件
		event.preventDefault();
		//循环查看状态
		//进度条	
		var t = setInterval(function(){
					$.ajax({
						url : 'http://localhost:8080/videoServer/ProgressServlet/progress',
						type : 'post',
						data :formData,
						contentType: false, //禁止设置请求类型
			            processData: false, //禁止jquery对DAta数据的处理,默认会处理
			            dataType:"json",
						success : function(data) {
							//前台更新进度
							progress.innerText = parseInt((data.progress / data.size) * 100);
							/* var jd =parseInt((data.progress / data.size) * 100);
							alert(jd); */
							//$("#jd").val(jd);
							//$("#progress").val("<div class='progress-bar progress-bar-success' role='progressbar' aria-valuenow='60' aria-valuemin='0' aria-valuemax='100' style='width:90%;'></div>");
							//progress.innerText = jd;
						},
						error : function() {
							alert("error");
						}
					});		
				}, 500);
		//上传文件
		
		$.ajax({
			url : 'http://localhost:8080/videoServer/UploadServlet/upload',
			type : 'post',
			data :formData,		    
	        cache: false,   	
		    processData: false,
			contentType: false, 
			success : function(responseText) {
				alert(responseText);
				//上传完成，清除循环事件
			    clearInterval(t);
				//将进度更新至100%
			    //$("#jd").val(100);
			    progress.innerText = 100;
			},
			error : function() {
				alert("error");
			}
		});		
														
	});
	alert(4);
})();
	</script>

</html>
