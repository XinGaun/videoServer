<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- <style type="text/css">
#jd:after {
	content: '%';
}
</style> -->
<link rel="stylesheet"
	href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
<script
	src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>


<body>
	<h3>File upload demo</h3>
	<form action="/UploadServlet/upload" method="post"
		enctype="multipart/form-data" id="dataForm">
		<input type="text" name="fileName" id="fileName"> <br> <input
			type="file" name="video_url" id="videourl"><br> <input
			type="file" name="image_url" id="imageurl"> <br> <input
			type="submit" value="submit" id="submit">
	</form>
	
	<div id="progress" class="progress" style="width: 80%;">
	
	</div>
<!-- 	<div id="jd" >
	    
    </div> -->

<script src="assets/js/jquery-1.10.2.js"></script>
<script type="text/javascript">
		(function() {
			$("#submit")
					.click(
							function(event) {
								//阻止默认事件
								event.preventDefault();
								//循环查看状态
								var t = setInterval(
										function() {
											$
													.ajax({
														url : 'http://localhost:8080/videoServer/ProgressServlet/progress',
														type : 'post',
														data : {
															fileName : $(
																	"#fileName")
																	.val(),
															filePath : $(
																	"#videourl")
																	.val(),
														},
														success : function(data) {
															//前台更新进度
															var jd =parseInt((data.progress / data.size) * 100);
															//$("#jd").val(jd);
															$("#progress").val("<div class='progress-bar progress-bar-success' role='progressbar' aria-valuenow='60' aria-valuemin='0' aria-valuemax='100' style='width:90%;'></div>");
															
														},
														error : function() {
															console
																	.log("error");
														}
													});
										}, 500);
								//上传文件
								alert(3);
								$.ajax({
											url : 'http://localhost:8080/videoServer/UploadServlet/upload',
											type : 'post',
											data : {
												fileName : $("#fileName").val(),
												video_url : $("#videourl")
														.val(),
												image_url : $("#imageurl")
														.val()
											},
											/*    processData: false,
											   contentType: false, */
											success : function(responseText) {
												//上传完成，清除循环事件
												clearInterval(t);
												//将进度更新至100%
												progress.innerText = 100;
											},
											error : function() {
												console.log("error");
											}
										});
								return false;
								alert(4);
							});
		})();
	</script>
</body>
</html>
